#!/bin/bash
#/ Usage: ./start [--pull]
# Runs https://github.com/Ocawesome101/pieces-to-practice

set -e

IMAGE=ghcr.io/ocawesome101/pieces-to-practice:primary
CONTAINER=ptp

if [ "$1" == "--pull" ]; then
  docker pull "${IMAGE}"
fi

echo stopping the old container...
docker rm -f "${CONTAINER}" || true

echo starting the new container...
docker run \
  --name "${CONTAINER}" \
  -d --restart=unless-stopped \
  -u "$(id -u oliver):$(id -g oliver)" \
  -v /data/oliver/ptp:/my-stuff/.piecestopractice \
  --env TZ=America/Indianapolis \
  --env HOME=/my-stuff \
  --entrypoint /usr/bin/env \
  "${IMAGE}" lua ws.lua 8888
